#!/usr/bin/env bash

set -e

# Google Font Name
GFONTNAME="Montserrat"

# Pretend to be firefox to get woff2. I honestly don't care if you don't support woff2.
UA="User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:138.0) Gecko/20100101 Firefox/138.0"

# Google Fonts URL
GF_URL="https://fonts.googleapis.com/css?family=${GFONTNAME}"

# FontAwesome Version and URL
FA_GIT="https://github.com/FortAwesome/Font-Awesome"

# Which css to use: all.css is pretty, all.min.css is not
FA_CSS="all.min.css"


if [ -f fonts.css ]; then
	echo "Looks like you've done this already."
	exit 1
fi


###
#
# Google Fonts Phase

# get CSS
curl -H "${UA}" -o gfonts.css $GF_URL

# Â¡STOLEN!
FONTS=( $(grep -Eo "(http|https)://[a-zA-Z0-9./?=_%:-]*" gfonts.css) )

for i in "${!FONTS[@]}"; do

	NEWNAME="${GFONTNAME}${i}.woff2"
	OLDNAME=${FONTS[$i]}

	curl -o $NEWNAME $OLDNAME
	sed -i -e "s,$OLDNAME,$NEWNAME," gfonts.css

done

###
#
# Font Awesome Phase

git clone --depth 1 https://github.com/FortAwesome/Font-Awesome
cp Font-Awesome/webfonts/* .
cp Font-Awesome/css/${FA_CSS} fa.css
sed -i -e 's,../webfonts/,,g' fa.css
rm -Rf Font-Awesome

###
#
# Combining Phase
DATE=$(date)
echo "/* this fonts.css generated by a shell script on ${DATE} */" > fonts.css
echo "/* Google Fonts Phase */" >> fonts.css
echo "" >> fonts.css
cat gfonts.css >> fonts.css
echo "/* FontAwesome Phase */" >> fonts.css
echo "" >> fonts.css
cat fa.css >> fonts.css

rm fa.css gfonts.css

echo
echo "Done!  I trust you'll follow the gfonts and FA license or whatever."
echo "Delete this script afterwards for deployment."




